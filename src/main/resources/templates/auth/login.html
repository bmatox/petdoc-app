<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login - PetDoc</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" th:href="@{/css/login.css}">
</head>
<body>

<div id="loginApp">
<div class="container-fluid ps-md-0">
    <div class="row g-0">
        <div class="d-none d-md-flex col-md-4 col-lg-6 position-relative">
            <div id="loginCarousel" class="carousel slide carousel-fade h-100" data-bs-ride="carousel" data-bs-interval="3000">

                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#loginCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#loginCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#loginCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    <button type="button" data-bs-target="#loginCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
                </div>

                <div class="carousel-inner h-100">
                    <div class="carousel-item active h-100">
                        <img th:src="@{/images/image1.jpg}" class="d-block w-100" alt="Cachorro com seu dono">
                    </div>
                    <div class="carousel-item h-100">
                        <img th:src="@{/images/image2.jpg}" class="d-block w-100" alt="Pata de um gato">
                    </div>
                    <div class="carousel-item h-100">
                        <img th:src="@{/images/image3.jpg}" class="d-block w-100" alt="Cachorro com coleira">
                    </div>
                    <div class="carousel-item h-100">
                        <img th:src="@{/images/image4.jpg}" class="d-block w-100" alt="Cachorro feliz">
                    </div>
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#loginCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#loginCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Próximo</span>
                </button>
            </div>
        </div>

        <div class="col-md-8 col-lg-6">
            <div class="login d-flex align-items-center py-5">
                <div class="container">
                    <div class="row">
                        <div class="col-md-9 col-lg-8 mx-auto">

                            <div class="text-center mb-5">
                                <img th:src="@{/images/petdoc-logo.png}" alt="Logo PetDoc" class="img-fluid rounded-circle logo-shadow" style="max-height: 80px;">
                                <h2 class="mt-3 petdoc-brand-name">PetDoc</h2>
                                <p class="text-muted">A saúde do seu pet na palma da sua mão.</p>
                            </div>

                            <h3 class="login-heading mb-4">Bem-vindo de volta!</h3>

                            <div th:if="${param.error}" class="alert alert-danger">
                                <i class="fas fa-exclamation-circle me-2"></i>Usuário ou senha inválidos.
                            </div>
                            <div th:if="${sucesso}" class="alert alert-success" th:text="${sucesso}">
                            </div>

                            <form id="loginForm" th:action="@{/login}" method="post">
                                <div class="form-floating mb-3">
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="username" 
                                        name="username" 
                                        placeholder="seu@email.com" 
                                        required 
                                        autofocus>
                                    <label for="username">E-mail</label>
                                    <div id="emailFeedback" class="invalid-feedback">
                                        <i class="fas fa-exclamation-circle me-1"></i><span id="emailError"></span>
                                    </div>
                                </div>
                                <div class="form-floating mb-3">
                                    <input 
                                        type="password" 
                                        class="form-control" 
                                        id="password" 
                                        name="password" 
                                        placeholder="Senha"
                                        required>
                                    <label for="password">Senha</label>
                                    <div id="passwordFeedback" class="invalid-feedback">
                                        <i class="fas fa-exclamation-circle me-1"></i><span id="passwordError"></span>
                                    </div>
                                </div>

                                <div class="d-grid">
                                    <button 
                                        id="submitButton"
                                        class="btn btn-lg btn-primary btn-login text-uppercase fw-bold mb-2" 
                                        type="submit">
                                        <i class="fas fa-sign-in-alt me-2"></i>Entrar
                                    </button>
                                    <div class="text-center">
                                        <a class="small" href="/cadastro" th:href="@{/cadastro}">Não tem uma conta? Cadastre-se</a>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
<script>
(function() {
    'use strict';
    
    // Aguardar o carregamento completo do DOM
    document.addEventListener('DOMContentLoaded', function() {
        
        // Verificar se Vue está disponível, caso contrário usar vanilla JS
        if (typeof Vue !== 'undefined') {
            // Implementação com Vue.js 3
            const { createApp } = Vue;
            
            createApp({
                data() {
                    return {
                        formData: {
                            email: '',
                            password: ''
                        },
                        emailTouched: false,
                        passwordTouched: false,
                        isLoading: false
                    };
                },
                computed: {
                    emailError() {
                        if (!this.formData.email) {
                            return 'O e-mail é obrigatório';
                        }
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(this.formData.email)) {
                            return 'Por favor, insira um e-mail válido';
                        }
                        return '';
                    },
                    passwordError() {
                        if (!this.formData.password) {
                            return 'A senha é obrigatória';
                        }
                        if (this.formData.password.length < 8) {
                            return 'A senha deve ter no mínimo 8 caracteres';
                        }
                        return '';
                    },
                    isFormValid() {
                        return !this.emailError && !this.passwordError && 
                               this.formData.email && this.formData.password;
                    }
                },
                methods: {
                    validateEmail() {
                        // Validação em tempo real
                    },
                    validatePassword() {
                        // Validação em tempo real
                    },
                    handleSubmit(event) {
                        this.emailTouched = true;
                        this.passwordTouched = true;
                        
                        if (!this.isFormValid) {
                            event.preventDefault();
                            return;
                        }
                        
                        this.isLoading = true;
                        // O formulário será enviado normalmente ao Spring Security
                    }
                },
                mounted() {
                    // Renderizar formulário Vue
                    const form = document.getElementById('loginForm');
                    if (form) {
                        // Substituir campos simples por campos reativos do Vue
                        const emailInput = document.getElementById('username');
                        const passwordInput = document.getElementById('password');
                        
                        if (emailInput && passwordInput) {
                            emailInput.addEventListener('input', (e) => {
                                this.formData.email = e.target.value;
                                this.validateEmail();
                            });
                            emailInput.addEventListener('blur', () => {
                                this.emailTouched = true;
                            });
                            
                            passwordInput.addEventListener('input', (e) => {
                                this.formData.password = e.target.value;
                                this.validatePassword();
                            });
                            passwordInput.addEventListener('blur', () => {
                                this.passwordTouched = true;
                            });
                        }
                        
                        form.addEventListener('submit', this.handleSubmit);
                    }
                }
            }).mount('#loginApp');
            
        } else {
            // Fallback: Implementação com vanilla JavaScript puro
            initVanillaJS();
        }
    });
    
    function initVanillaJS() {
        const emailInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const submitButton = document.getElementById('submitButton');
        const loginForm = document.getElementById('loginForm');
        
        let emailTouched = false;
        let passwordTouched = false;
        
        // Função de validação de e-mail
        function validateEmail() {
            const email = emailInput.value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (!emailTouched) return { valid: true, message: '' };
            
            if (!email) {
                return { valid: false, message: 'O e-mail é obrigatório' };
            }
            if (!emailRegex.test(email)) {
                return { valid: false, message: 'Por favor, insira um e-mail válido' };
            }
            return { valid: true, message: '' };
        }
        
        // Função de validação de senha
        function validatePassword() {
            const password = passwordInput.value;
            
            if (!passwordTouched) return { valid: true, message: '' };
            
            if (!password) {
                return { valid: false, message: 'A senha é obrigatória' };
            }
            if (password.length < 8) {
                return { valid: false, message: 'A senha deve ter no mínimo 8 caracteres' };
            }
            return { valid: true, message: '' };
        }
        
        // Atualizar feedback visual
        function updateFieldFeedback(input, feedbackId, errorId, validation) {
            const feedbackDiv = document.getElementById(feedbackId);
            const errorSpan = document.getElementById(errorId);
            
            if (validation.valid && input.value) {
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
                if (feedbackDiv) feedbackDiv.style.display = 'none';
            } else if (!validation.valid) {
                input.classList.remove('is-valid');
                input.classList.add('is-invalid');
                if (errorSpan) errorSpan.textContent = validation.message;
                if (feedbackDiv) feedbackDiv.style.display = 'block';
            } else {
                input.classList.remove('is-valid', 'is-invalid');
                if (feedbackDiv) feedbackDiv.style.display = 'none';
            }
        }
        
        // Event listeners
        emailInput.addEventListener('input', function() {
            const validation = validateEmail();
            updateFieldFeedback(emailInput, 'emailFeedback', 'emailError', validation);
        });
        
        emailInput.addEventListener('blur', function() {
            emailTouched = true;
            const validation = validateEmail();
            updateFieldFeedback(emailInput, 'emailFeedback', 'emailError', validation);
        });
        
        passwordInput.addEventListener('input', function() {
            const validation = validatePassword();
            updateFieldFeedback(passwordInput, 'passwordFeedback', 'passwordError', validation);
        });
        
        passwordInput.addEventListener('blur', function() {
            passwordTouched = true;
            const validation = validatePassword();
            updateFieldFeedback(passwordInput, 'passwordFeedback', 'passwordError', validation);
        });
        
        // Envio do formulário
        loginForm.addEventListener('submit', function(event) {
            emailTouched = true;
            passwordTouched = true;
            
            const emailValidation = validateEmail();
            const passwordValidation = validatePassword();
            
            updateFieldFeedback(emailInput, 'emailFeedback', 'emailError', emailValidation);
            updateFieldFeedback(passwordInput, 'passwordFeedback', 'passwordError', passwordValidation);
            
            if (!emailValidation.valid || !passwordValidation.valid) {
                event.preventDefault();
                return false;
            }
            
            // Adicionar estado de loading ao botão
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Entrando...';
            
            // O formulário será enviado normalmente
            return true;
        });
    }
})();
</script>
<div th:replace="~{fragments/footer :: main-footer}"></div>

</body>
</html>